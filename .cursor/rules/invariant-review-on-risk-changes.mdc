---
description: When reviewing execution/risk PRs or diffs, use the invariant-first-review skill
globs: src/risk/**/*.py, src/execution/**/*.py, src/live/protection_ops.py, src/live/auction_runner.py
alwaysApply: false
---

# Invariant-first review on risk/execution changes

When the user asks to **review a PR**, **review a diff**, or **review changes** that touch order execution, risk limits, position/TP logic, DRY_RUN/ENV, or concurrency:

1. **Use the invariant-first-review skill.** Read and follow the skill at `~/.cursor/skills/invariant-first-review/SKILL.md`.
2. **Scope:** Identify system invariants (e.g. sum(tp_qtys) ≤ position_qty; tp_qty ≥ venue_min or skip; margin caps; single TP placement path; no test_db/MagicMock in prod). Check that the diff enforces them along the call graph, including config defaults and ENV gating.
3. **Loss modes:** Enumerate ways the change could cause loss, undefined behaviour, or silent drift; note mitigations or suggest fixes.
4. **Output:** Summarise: invariants checked, bypass paths (if any), and whether the change is safe to merge/deploy.

If the skill file is missing, still perform an invariant-oriented review: list invariants that apply, verify they hold after the change, and call out any new bypass or risk.
