# Configuration

## Exchange Settings
exchange:
  name: "kraken"
  spot_markets:
    - "BTC/USD"
    - "ETH/USD"
  futures_markets:
    - "BTCUSD-PERP"
    - "ETHUSD-PERP"
    
  # Credentials
  api_key: "${KRAKEN_API_KEY}"
  api_secret: "${KRAKEN_API_SECRET}"
  futures_api_key: "${KRAKEN_FUTURES_API_KEY}"
  futures_api_secret: "${KRAKEN_FUTURES_API_SECRET}"
  use_testnet: false

## Risk Management
risk:
  # Position sizing (ULTRA-CONSERVATIVE for live start)
  risk_per_trade_pct: 0.003  # 0.3% of account equity per trade
  max_leverage: 10.0  # Use full 10x leverage capacity
  
  # Liquidation safety
  min_liquidation_buffer_pct: 0.35  # 35% minimum distance from liquidation price
  
  # Portfolio limits (CONSERVATIVE for live start)
  # Portfolio limits (Scaled for Multi-Asset)
  max_concurrent_positions: 5  # Allow up to 5 parallel trades
  daily_loss_limit_pct: 0.01  # 1% daily loss limit (strict)
  loss_streak_cooldown: 3  # Halt after 3 consecutive losses
  
  # Basis guards
  basis_max_pct: 0.0075  # 0.75% max spot-perp divergence for entry
  basis_max_post_pct: 0.0075  # Post-entry divergence limit (same as entry)
  
  # Cost-aware validation
  # Cost-aware validation
  max_fee_funding_rr_distortion_pct: 0.20  # Hard cap (allows 20% for tight stops)
  rr_distortion_strict_limit_pct: 0.10  # Strict cap for normal stops (>1.5%)
  tight_stop_threshold_pct: 0.015  # Definition of "tight stop" (1.5%)
  funding_cost_threshold_pct: 0.02  # Optional: block entries if projected funding > 2%

  # V2.1 Regime Risk
  tight_smc_cost_cap_bps: 25.0
  tight_smc_min_rr_multiple: 2.0
  tight_smc_avg_hold_hours: 6.0
  wide_structure_max_distortion_pct: 0.15
  wide_structure_avg_hold_hours: 36.0
  
  loss_streak_cooldown_tight: 3
  loss_streak_cooldown_wide: 5
  loss_streak_pause_minutes_tight: 120
  loss_streak_pause_minutes_wide: 90
  loss_streak_min_loss_bps: 20.0

## Strategy Parameters
strategy:
  # Timeframes
  bias_timeframes:
    - "4h"
    - "1d"
  execution_timeframes:
    - "15m"
    - "1h"
  
  # Indicators
  ema_period: 200
  adx_period: 14
  adx_threshold: 25.0  # Minimum ADX for trend strength
  atr_period: 14
  atr_multiplier_stop: 1.5  # ATR multiplier for stop-loss buffer
  rsi_period: 14
  rsi_divergence_enabled: false  # Optional confirmation only
  
  # SMC Parameters
  orderblock_lookback: 50
  fvg_min_size_pct: 0.001  # 0.1% minimum gap size
  bos_confirmation_candles: 3

  # V2.1 Scoring & Regimes
  ema_neutral_zone_bps: 10.0
  min_score_tight_smc_aligned: 70.0
  min_score_tight_smc_neutral: 75.0
  min_score_wide_structure_aligned: 65.0
  min_score_wide_structure_neutral: 70.0
  fib_proximity_bps: 20.0
  
  # Regime-specific stops
  tight_smc_atr_stop_min: 0.3
  tight_smc_atr_stop_max: 0.6
  wide_structure_atr_stop_min: 1.0
  wide_structure_atr_stop_max: 1.2

## Execution Settings
execution:
  # Price conversion
  use_mark_price: true  # Always true for safety-critical operations
  
  # Order settings
  default_order_type: "limit"
  slippage_tolerance_pct: 0.001  # 0.1%
  order_timeout_seconds: 30
  max_retries: 3
  retry_backoff_seconds: 2
  
  # Pyramiding
  pyramiding_enabled: false  # Default: no adding to positions

## Multi-TP Configuration (V2)
multi_tp:
  enabled: true
  tp1_r_multiple: 1.0   # Close 40% at 1R
  tp1_close_pct: 0.40
  tp2_r_multiple: 2.5   # Close 40% at 2.5R
  tp2_close_pct: 0.40
  runner_pct: 0.20      # Keep 20% as runner
  move_sl_to_be_after_tp1: true  # Auto move to breakeven after TP1
  trailing_stop_enabled: true    # Enable trailing for runner
  trailing_stop_atr_multiplier: 1.5

## Data Acquisition
data:
  # WebSocket settings
  ws_reconnect_max_retries: 10
  ws_reconnect_backoff_seconds: 5
  
  # Data validation
  max_gap_seconds: 60  # Alert if data gap > 1 minute
  
  # Storage
  database_url: "${DATABASE_URL}"  # From environment variable
  
## Reconciliation
reconciliation:
  # Event-driven: immediate on fills, order updates, margin updates
  periodic_interval_seconds: 15
  
## Monitoring
monitoring:
  # Logging
  log_level: "INFO"  # DEBUG/INFO/WARNING/ERROR/CRITICAL
  log_format: "json"
  
  # Alerts
  alert_margin_usage_threshold_pct: 0.70  # 70%
  alert_liquidation_buffer_threshold_pct: 0.35  # Alert if < 35%
  alert_repeated_rejections_count: 3
  alert_repeated_rejections_window_seconds: 300
  
  # Alert delivery (configure as needed)
  alert_methods:
    - "log"  # Always log alerts
    # - "email"
    # - "telegram"
    # - "slack"

## Backtesting
backtest:
  # Starting capital
  starting_equity: 10000  # $10,000 starting capital
  
  # Fill assumptions
  assume_maker_fills: true  # Assume limit orders fill at maker fee
  slippage_bps: 2  # 2 basis points average slippage
  
  # Cost modeling
  maker_fee_bps: 2  # Kraken Futures maker fee (check current rates)
  taker_fee_bps: 5  # Kraken Futures taker fee
  
  # Basis modeling
  basis_model: "static"  # static / stochastic
  static_basis_bps: 5  # 5 basis points static basis assumption

## Paper Trading
paper:
  # Simulation settings
  simulate_realistic_slippage: true
  simulate_fill_delays_ms: 100

## Live Trading
live:
  # Safety gates
  require_paper_success: true
  min_paper_days: 30
  min_paper_trades: 50
  max_paper_drawdown_pct: 0.15  # Paper must stay within 15% DD

## Coin Universe (V3 - Full Kraken Integration)
# Total: 249 coins available on both Spot and Futures
coin_universe:
  enabled: true
  min_spot_volume_24h: 1000000  # $1M minimum
  
  # Liquidity tiers (A = highest, B = medium, C = lower)
  liquidity_tiers:
    # Tier A: Top 20 major coins (20 coins)
    A:
      - "XBT/USD"
      - "ETH/USD"
      - "SOL/USD"
      - "BNB/USD"
      - "XRP/USD"
      - "ADA/USD"
      - "AVAX/USD"
      - "DOT/USD"
      - "LINK/USD"
      - "UNI/USD"
      - "LTC/USD"
      - "BCH/USD"
      - "ATOM/USD"
      - "TON/USD"
      - "TRX/USD"
      - "ICP/USD"
      - "NEAR/USD"
      - "APT/USD"
      - "SUI/USD"
      - "OP/USD"

    # Tier B: Established altcoins (50 coins)
    B:
      - "ARB/USD"
      - "FIL/USD"
      - "IMX/USD"
      - "INJ/USD"
      - "TIA/USD"
      - "SEI/USD"
      - "AAVE/USD"
      - "SNX/USD"
      - "CRV/USD"
      - "LDO/USD"
      - "RENDER/USD"
      - "GRT/USD"
      - "SAND/USD"
      - "MANA/USD"
      - "AXS/USD"
      - "GALA/USD"
      - "ENJ/USD"
      - "CHZ/USD"
      - "FLOW/USD"
      - "EGLD/USD"
      - "XTZ/USD"
      - "ALGO/USD"
      - "ETC/USD"
      - "KAS/USD"
      - "FET/USD"
      - "HBAR/USD"
      - "VET/USD"
      - "XLM/USD"
      - "XMR/USD"
      - "ZEC/USD"
      - "DASH/USD"
      - "COMP/USD"
      - "YFI/USD"
      - "UMA/USD"
      - "BAT/USD"
      - "ZRX/USD"
      - "1INCH/USD"
      - "SUSHI/USD"
      - "DYDX/USD"
      - "GMX/USD"
      - "PERP/USD"
      - "RUNE/USD"
      - "KAVA/USD"
      - "CELO/USD"
      - "QTUM/USD"
      - "ICX/USD"
      - "ENS/USD"
      - "BLUR/USD"
      - "PENDLE/USD"
      - "ONDO/USD"

    # Tier C: Remaining coins (179 coins)
    C:
      - "2Z/USD"
      - "AEVO/USD"
      - "AGLD/USD"
      - "AIXBT/USD"
      - "AKT/USD"
      - "ALCH/USD"
      - "ALICE/USD"
      - "ALT/USD"
      - "ANIME/USD"
      - "ANKR/USD"
      - "APE/USD"
      - "API3/USD"
      - "AR/USD"
      - "ARC/USD"
      - "ARKM/USD"
      - "ASTER/USD"
      - "ASTR/USD"
      - "ATH/USD"
      - "AUCTION/USD"
      - "AUD/USD"
      - "B3/USD"
      - "BAND/USD"
      - "BEAM/USD"
      - "BERA/USD"
      - "BICO/USD"
      - "BIGTIME/USD"
      - "BIO/USD"
      - "BNT/USD"
      - "BONK/USD"
      - "BSU/USD"
      - "C98/USD"
      - "CAKE/USD"
      - "CAT/USD"
      - "CELR/USD"
      - "CHR/USD"
      - "COOKIE/USD"
      - "COTI/USD"
      - "COW/USD"
      - "CRO/USD"
      - "CTSI/USD"
      - "CVX/USD"
      - "CYBER/USD"
      - "DEEP/USD"
      - "DEGEN/USD"
      - "DENT/USD"
      - "DOG/USD"
      - "DOGS/USD"
      - "DRIFT/USD"
      - "DYM/USD"
      - "EIGEN/USD"
      - "ENA/USD"
      - "ESPORTS/USD"
      - "ETHFI/USD"
      - "ETHW/USD"
      - "EUR/USD"
      - "FARTCOIN/USD"
      - "FLOKI/USD"
      - "FLR/USD"
      - "FLUX/USD"
      - "FOLKS/USD"
      - "FXS/USD"
      - "G/USD"
      - "GBP/USD"
      - "GIGA/USD"
      - "GMT/USD"
      - "GOAT/USD"
      - "GRASS/USD"
      - "GRIFFAIN/USD"
      - "GTC/USD"
      - "HFT/USD"
      - "HIPPO/USD"
      - "HMSTR/USD"
      - "INIT/USD"
      - "IP/USD"
      - "JASMY/USD"
      - "JTO/USD"
      - "JUP/USD"
      - "KAITO/USD"
      - "KSM/USD"
      - "LAYER/USD"
      - "LCAP/USD"
      - "LPT/USD"
      - "LQTY/USD"
      - "LRC/USD"
      - "LSK/USD"
      - "LUNA2/USD"
      - "ME/USD"
      - "MELANIA/USD"
      - "METIS/USD"
      - "MEW/USD"
      - "MINA/USD"
      - "MIRA/USD"
      - "MNT/USD"
      - "MOG/USD"
      - "MON/USD"
      - "MOODENG/USD"
      - "MORPHO/USD"
      - "MOVE/USD"
      - "MOVR/USD"
      - "MUBARAK/USD"
      - "NEIRO/USD"
      - "NIGHT/USD"
      - "NMR/USD"
      - "NOT/USD"
      - "OGN/USD"
      - "OM/USD"
      - "OMI/USD"
      - "OPEN/USD"
      - "ORCA/USD"
      - "ORDER/USD"
      - "OXT/USD"
      - "PAXG/USD"
      - "PENGU/USD"
      - "PEPE/USD"
      - "PNUT/USD"
      - "POL/USD"
      - "PONKE/USD"
      - "POPCAT/USD"
      - "PORTAL/USD"
      - "POWR/USD"
      - "PRCL/USD"
      - "PROMPT/USD"
      - "PUMP/USD"
      - "PYTH/USD"
      - "QNT/USD"
      - "RARE/USD"
      - "RARI/USD"
      - "RAY/USD"
      - "REZ/USD"
      - "RLC/USD"
      - "RSR/USD"
      - "S/USD"
      - "SAGA/USD"
      - "SHIB/USD"
      - "SOLV/USD"
      - "SONIC/USD"
      - "SOON/USD"
      - "SPELL/USD"
      - "SPK/USD"
      - "SPX/USD"
      - "SSV/USD"
      - "STBL/USD"
      - "STG/USD"
      - "STORJ/USD"
      - "STRK/USD"
      - "STX/USD"
      - "SUN/USD"
      - "SUPER/USD"
      - "SWARMS/USD"
      - "SWELL/USD"
      - "SXT/USD"
      - "SYN/USD"
      - "SYRUP/USD"
      - "T/USD"
      - "TAO/USD"
      - "TLM/USD"
      - "TNSR/USD"
      - "TOKEN/USD"
      - "TOSHI/USD"
      - "TRU/USD"
      - "TRUMP/USD"
      - "TURBO/USD"
      - "USUAL/USD"
      - "VINE/USD"
      - "VIRTUAL/USD"
      - "W/USD"
      - "WIF/USD"
      - "WLD/USD"
      - "WLFI/USD"
      - "WOO/USD"
      - "XAUT/USD"
      - "XCN/USD"
      - "XPL/USD"
      - "YGG/USD"
      - "ZBT/USD"
      - "ZEREBRO/USD"
      - "ZETA/USD"
      - "ZK/USD"
      - "ZRO/USD"

  # Max leverage per tier (respects global 10x cap)
  tier_max_leverage:
    A: 10.0
    B: 7.0
    C: 5.0

## Environment
environment: "prod"  # LIVE TRADING MODE - REAL CAPITAL AT RISK
